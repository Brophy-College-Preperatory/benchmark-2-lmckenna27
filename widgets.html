<!DOCTYPE html>
<html lang="en">
<head>
    <title>Wizard - Widgets</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
</head>

<body>
  <script src="scripts.js"></script>

  <div class="container" id="nav">
    <div class="container-box left" id="nav">
      <a id="nav" href="home.html"><img style="width: 85px;" src="./assets/logo.svg"></a>
    </div>
    <div class="container-box middle" id="nav">
      <a class="fine" id="nav" href="widgets.html">Widgets</a>
      <a class="fine" id="nav" href="pricing.html">Pricing</a>
      <a class="fine" id="nav" href="">Blog</a>
      <a class="fine" id="nav" href="about.html">About</a>
    </div>
    <div class="container-box right" id="nav">
      <button id="nav" style="background: none; color: #000000;">Log in</button>
      <button id="nav">Start for free</button>
    </div>
  </div>

  <div class="container" id="home-header">
    <div class="container-box top" id="home-header" style="margin-top: -90px;">
      <p class="title" id="home-header">All your widgets in one place.</p>
      <p class="subtitle" id="home-header">Explore below.</p>
    </div>
  </div>

  <div class="container-wrapper" id="weather">
    <div class="container" id="weather" style="background: none;">
      <select id="weather" data-alt-id="location-selection">
        <option value="33.4484,-112.0740">Phoenix, AZ</option>
        <option value="34.0522,-118.2437">Los Angeles, CA</option>
        <option value="40.7128,-74.0060">New York, NY</option>
        <option value="41.8781,-87.6298">Chicago, IL</option>
        <option value="29.7604,-95.3698">Houston, TX</option>
        <option value="39.7392,-104.9903">Denver, CO</option>
        <option value="25.7617,-80.1918">Miami, FL</option>
        <option value="47.6062,-122.3321">Seattle, WA</option>
        <option value="38.9072,-77.0369">Washington, DC</option>
        <option value="32.7767,-96.7970">Dallas, TX</option>
        <option value="37.7749,-122.4194">San Francisco, CA</option>
        <option value="33.7490,-84.3880">Atlanta, GA</option>
        <option value="42.3601,-71.0589">Boston, MA</option>
        <option value="36.1627,-86.7816">Nashville, TN</option>
        <option value="39.9612,-82.9988">Columbus, OH</option>
        <option value="35.2271,-80.8431">Charlotte, NC</option>
        <option value="44.9778,-93.2650">Minneapolis, MN</option>
        <option value="39.7684,-86.1581">Indianapolis, IN</option>
        <option value="45.5152,-122.6784">Portland, OR</option>
        <option value="36.1699,-115.1398">Las Vegas, NV</option>
        <option value="35.0844,-106.6504">Albuquerque, NM</option>
        <option value="35.4676,-97.5164">Oklahoma City, OK</option>
        <option value="43.0389,-87.9065">Milwaukee, WI</option>
        <option value="27.9506,-82.4572">Tampa, FL</option>
        <option value="39.1031,-84.5120">Cincinnati, OH</option>
        <option value="33.5207,-86.8025">Birmingham, AL</option>
        <option value="32.7157,-117.1611">San Diego, CA</option>
        <option value="30.2672,-97.7431">Austin, TX</option>
        <option value="36.1745,-115.1372">Paradise, NV</option>
        <option value="37.3382,-121.8863">San Jose, CA</option>
        <option value="43.6532,-79.3832">Toronto, ON</option>
        <option value="51.5072,0.1276">London, UK</option>
      </select>
    </div>

    <div class="container" id="weather">
      <div class="container-box top-left" id="weather">
        <img data-alt-id="main-icon" class="large" src="">
      </div>
      <div class="container-box top-middle" id="weather">
        <p class="subtitle" id="weather" data-alt-id="city-name">City</p>
        <p class="fine" id="weather" data-alt-id="main-description">Description</p>
        <p class="description" id="weather" data-alt-id="main-time">Time</p>
      </div>
      <div class="container-box top-right" id="weather">
        <p class="title" id="weather" data-alt-id="main-temp">0°</p>
      </div>

      <div class="container-box bottom" id="weather">
        <div class="container-sub-box" id="weather">
          <img class="medium" data-alt-id="hour-icon-0" src="">
          <p class="description" id="weather" data-alt-id="hour-temp-0">0°</p>
          <p class="fine" id="weather" data-alt-id="hour-time-0">00:00</p>
        </div>
        <div class="container-sub-box" id="weather">
          <img class="medium" data-alt-id="hour-icon-1" src="">
          <p class="description" id="weather" data-alt-id="hour-temp-1">0°</p>
          <p class="fine" id="weather" data-alt-id="hour-time-1">00:00</p>
        </div>
        <div class="container-sub-box" id="weather">
          <img class="medium" data-alt-id="hour-icon-2" src="">
          <p class="description" id="weather" data-alt-id="hour-temp-2">0°</p>
          <p class="fine" id="weather" data-alt-id="hour-time-2">00:00</p>
        </div>
        <div class="container-sub-box" id="weather">
          <img class="medium" data-alt-id="hour-icon-3" src="">
          <p class="description" id="weather" data-alt-id="hour-temp-3">0°</p>
          <p class="fine" id="weather" data-alt-id="hour-time-3">00:00</p>
        </div>
        <div class="container-sub-box" id="weather">
          <img class="medium" data-alt-id="hour-icon-4" src="">
          <p class="description" id="weather" data-alt-id="hour-temp-4">0°</p>
          <p class="fine" id="weather" data-alt-id="hour-time-4">00:00</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const locationSelect = document.querySelector(`[data-alt-id="location-selection"]`);
    const masterMap = {
      0: { icon: 'visibility/clear.svg', desc: 'Clear sky' },
      1: { icon: 'visibility/mainly-clear.svg', desc: 'Mainly clear' },
      2: { icon: 'visibility/partly-cloudy.svg', desc: 'Partly cloudy' },
      3: { icon: 'visibility/neutral/overcast.svg', desc: 'Overcast' },
      45: { icon: 'visibility/neutral/fog.svg', desc: 'Fog' },
      48: { icon: 'visibility/neutral/fog.svg', desc: 'Depositing rime fog' },
      51: { icon: 'precipitation/sprinkle.svg', desc: 'Light drizzle' },
      53: { icon: 'precipitation/sprinkle.svg', desc: 'Moderate drizzle' },
      55: { icon: 'precipitation/sprinkle.svg', desc: 'Dense drizzle' },
      56: { icon: 'precipitation/sprinkle.svg', desc: 'Light freezing drizzle' },
      57: { icon: 'precipitation/sprinkle.svg', desc: 'Dense freezing drizzle' },
      61: { icon: 'precipitation/light-rain.svg', desc: 'Slight rain' },
      66: { icon: 'precipitation/light-rain.svg', desc: 'Light freezing rain' },
      80: { icon: 'precipitation/light-rain.svg', desc: 'Slight rain shower' },
      63: { icon: 'precipitation/rain.svg', desc: 'Moderate rain' },
      65: { icon: 'precipitation/rain.svg', desc: 'Heavy rain' },
      67: { icon: 'precipitation/rain.svg', desc: 'Heavy freezing rain' },
      81: { icon: 'precipitation/rain.svg', desc: 'Moderate rain shower' },
      82: { icon: 'precipitation/rain.svg', desc: 'Violent rain shower' },
      71: { icon: 'precipitation/snow.svg', desc: 'Slight snow' },
      73: { icon: 'precipitation/snow.svg', desc: 'Moderate snow' },
      75: { icon: 'precipitation/snow.svg', desc: 'Heavy snow' },
      77: { icon: 'precipitation/snow.svg', desc: 'Snow grains' },
      85: { icon: 'precipitation/snow.svg', desc: 'Slight snow shower' },
      86: { icon: 'precipitation/snow.svg', desc: 'Heavy snow shower' },
      95: { icon: 'storm/thunderstorm.svg', desc: 'Slight thunderstorm' },
      96: { icon: 'storm/hail-thunderstorm.svg', desc: 'Slight hail thunderstorm' },
      99: { icon: 'storm/hail-thunderstorm.svg', desc: 'Heavy hail thunderstorm' }
    };

    function getIcon(weatherCode, isDay) {
      const selectedIcon = masterMap[weatherCode].icon || 'visibility/clear.svg';

      if (selectedIcon.includes('/neutral/')) {
        return `./assets/weather-icons/${selectedIcon}`;
      }

      const iconCategory = selectedIcon.split('/')[0];
      const iconType = isDay ? 'day' : 'night';
      const iconName = selectedIcon.split('/')[1];

      return `./assets/weather-icons/${iconCategory}/${iconType}/${iconName}`;
    }

    function updateWeather(lat, lon, cityName) {
      fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,weathercode,is_day&current_weather=true&timezone=auto`)
        .then(res => res.json())
        .then(data => {
          const { weathercode, is_day, temperature, time: cwTime } = data.current_weather;

          document.querySelector('[data-alt-id="city-name"]').textContent = cityName;
          document.querySelector('[data-alt-id="main-description"]').textContent = masterMap[weathercode].desc;

          const mainTemp = Math.round((temperature * 9/5) + 32);
          const mainTime = new Date(cwTime).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', hour12: true});

          document.querySelector('[data-alt-id="main-icon"]').src = getIcon(weathercode, is_day);
          document.querySelector('[data-alt-id="main-temp"]').textContent = `${mainTemp}°`;
          document.querySelector('[data-alt-id="main-time"]').textContent = mainTime;

          const hourlyTimes = data.hourly.time;
          const hourlyTimestamp = cwTime.substring(0, 13) + ':00';

          let hourlyTimesIndex = hourlyTimes.indexOf(hourlyTimestamp);

          for (let i = 1; i <= 5; i++) {
            const index = hourlyTimesIndex + i;
            const hourlyWeatherCode  = data.hourly.weathercode[index];
            const hourlyIsDay = data.hourly.is_day[index];
            const hourlyTemperature = Math.round((data.hourly.temperature_2m[index] * 9/5) + 32)
            const hourlyTime = new Date(hourlyTimes[index]).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true }).split(' ')[0];

            document.querySelector(`[data-alt-id="hour-icon-${i-1}"]`).src = getIcon(hourlyWeatherCode, hourlyIsDay);
            document.querySelector(`[data-alt-id="hour-temp-${i-1}"]`).textContent = `${hourlyTemperature}°`;
            document.querySelector(`[data-alt-id="hour-time-${i-1}"]`).textContent = hourlyTime;
          }
        })
    }

    locationSelect.addEventListener('change', () => {
      const [lat, lon] = locationSelect.value.split(',');
      updateWeather(lat, lon, locationSelect.options[locationSelect.selectedIndex].text);
    });

    locationSelect.dispatchEvent(new Event('change'));
  </script>
</body>
</html>